{% extends 'base.html' %}

{% block titulo %}
Resumen de pedidos
{% endblock %}

{% block extra_head %}
<style>
    .resumen-simple .resumen-kpis {
        margin-bottom: 1rem;
    }

    .resumen-simple .resumen-kpi-card {
        animation: kpi-in 0.35s ease both;
    }

    .resumen-simple .resumen-kpi-card:nth-child(2) {
        animation-delay: 0.06s;
    }

    .resumen-simple .resumen-kpi-card:nth-child(3) {
        animation-delay: 0.12s;
    }

    .resumen-simple .resumen-kpi-card:nth-child(4) {
        animation-delay: 0.18s;
    }

    .resumen-simple .card + .card {
        margin-top: 1rem;
    }

    .resumen-simple .bloque-titulo {
        font-size: 0.95rem;
        font-weight: 700;
        color: #1d4ed8;
        margin-bottom: 0.6rem;
        text-transform: uppercase;
        letter-spacing: 0.02em;
    }

    .resumen-simple .resumen-table th,
    .resumen-simple .resumen-table td {
        vertical-align: middle;
        white-space: nowrap;
    }

    .resumen-simple .resumen-table tfoot th {
        background: #f8fafc;
    }

    .resumen-simple .row-gap {
        margin-top: 1rem;
    }

    @keyframes kpi-in {
        from {
            transform: translateY(8px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>
{% endblock %}

{% block contenido %}
<div class="container-fluid resumen-simple">
    <h1 class="h3 mb-2 text-gray-800">RESUMEN DE PEDIDOS</h1>
    <p class="text-muted mb-4">
        Vista simplificada de lunes a sabado por ciudad: totales por tipo de huevo y programacion por comercial.
    </p>

    <div class="row resumen-kpis">
        {% for tarjeta in tarjetas_resumen %}
        <div class="col-xl-3 col-md-6 mb-3 resumen-kpi-card">
            <div class="card border-left-{{ tarjeta.estilo }} shadow h-100 py-2">
                <div class="card-body">
                    <div class="text-xs font-weight-bold text-{{ tarjeta.estilo }} text-uppercase mb-1">{{ tarjeta.titulo }}</div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{ tarjeta.valor }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% for ciudad in resumen_ciudades %}
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">{{ ciudad.nombre|upper }}</h6>
            <div>
                <span class="mr-3"><strong>Total:</strong> {{ ciudad.total_general }} kg</span>
                <span class="mr-3 text-danger"><strong>Pendiente:</strong> {{ ciudad.total_pending }} kg</span>
                <span class="text-success"><strong>Confirmado:</strong> {{ ciudad.total_confirmed }} kg</span>
            </div>
        </div>
        <div class="card-body">
            <p class="bloque-titulo">1. Resumen Total Por Tipo De Huevo</p>
            <div class="table-responsive">
                <table class="table table-bordered table-responsive-stack resumen-table" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>TIPO</th>
                            {% for dia in ciudad.dias %}
                            <th>{{ dia.label|upper }}</th>
                            {% endfor %}
                            <th>TOTAL</th>
                            <th>TOTAL PENDIENTE</th>
                            <th>TOTAL CONFIRMADO</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tipo in ciudad.tipos %}
                        <tr>
                            <td data-label="Tipo">{{ tipo.etiqueta }}</td>
                            {% for dia in tipo.dias %}
                            <td data-label="{{ dia.label }}" class="{% if dia.pending %}text-danger font-weight-bold{% endif %}">
                                {{ dia.total }} kg
                            </td>
                            {% endfor %}
                            <td data-label="Total"><strong>{{ tipo.total_general }} kg</strong></td>
                            <td data-label="Total pendiente" class="text-danger"><strong>{{ tipo.total_pending }} kg</strong></td>
                            <td data-label="Total confirmado" class="text-success"><strong>{{ tipo.total_confirmed }} kg</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>TOTAL CIUDAD</th>
                            {% for dia in ciudad.totales_dia %}
                            <th class="{% if dia.pending %}text-danger{% endif %}">{{ dia.total }} kg</th>
                            {% endfor %}
                            <th>{{ ciudad.total_general }} kg</th>
                            <th class="text-danger">{{ ciudad.total_pending }} kg</th>
                            <th class="text-success">{{ ciudad.total_confirmed }} kg</th>
                        </tr>
                        <tr>
                            <th class="text-success">TOTAL CONFIRMADO</th>
                            {% for dia in ciudad.totales_dia %}
                            <th class="text-success">{{ dia.confirmed }} kg</th>
                            {% endfor %}
                            <th class="text-success">{{ ciudad.total_confirmed }} kg</th>
                            <th>-</th>
                            <th class="text-success">{{ ciudad.total_confirmed }} kg</th>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <p class="bloque-titulo row-gap">2. Programacion Por Comercial</p>
            <div class="table-responsive">
                <table class="table table-bordered table-responsive-stack resumen-table" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>COMERCIAL</th>
                            {% for dia in ciudad.dias %}
                            <th>{{ dia.label|upper }}</th>
                            {% endfor %}
                            <th>TOTAL</th>
                            <th>TOTAL PENDIENTE</th>
                            <th>TOTAL CONFIRMADO</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comercial in ciudad.comerciales %}
                        <tr>
                            <td data-label="Comercial">{{ comercial.nombre }}</td>
                            {% for dia in comercial.dias %}
                            <td data-label="{{ dia.label }}" class="{% if dia.pending %}text-danger font-weight-bold{% endif %}">
                                {{ dia.total }} kg
                            </td>
                            {% endfor %}
                            <td data-label="Total"><strong>{{ comercial.total_general }} kg</strong></td>
                            <td data-label="Total pendiente" class="text-danger"><strong>{{ comercial.total_pending }} kg</strong></td>
                            <td data-label="Total confirmado" class="text-success"><strong>{{ comercial.total_confirmed }} kg</strong></td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="{{ ciudad.dias|length|add:'4' }}" class="text-center text-muted">Sin pedidos programados</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>TOTAL CIUDAD</th>
                            {% for dia in ciudad.totales_dia %}
                            <th class="{% if dia.pending %}text-danger{% endif %}">{{ dia.total }} kg</th>
                            {% endfor %}
                            <th>{{ ciudad.total_general }} kg</th>
                            <th class="text-danger">{{ ciudad.total_pending }} kg</th>
                            <th class="text-success">{{ ciudad.total_confirmed }} kg</th>
                        </tr>
                        <tr>
                            <th class="text-success">TOTAL CONFIRMADO</th>
                            {% for dia in ciudad.totales_dia %}
                            <th class="text-success">{{ dia.confirmed }} kg</th>
                            {% endfor %}
                            <th class="text-success">{{ ciudad.total_confirmed }} kg</th>
                            <th>-</th>
                            <th class="text-success">{{ ciudad.total_confirmed }} kg</th>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <p class="small text-muted mb-0">Los valores en rojo incluyen pedidos pendientes.</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
